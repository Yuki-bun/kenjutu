## Project Overview

Revue is a Tauri 2 desktop application for viewing diff / github pull requests locally
focusing on per-commit review workflow

## Development Commands

```bash
# Build for production (takes a lot of time. Don't run this command for type checking)
pnpm tauri build

# Type checking
pnpm check

# Generate ts bindings for tauri commands
pnpm gen

# Cargo commands are available from the root of this repository
cargo build ....
```

## Architecture

### Frontend (`/src`)

- **React 19** with **TanStack Router** (file-based routing in `/src/routes`)
- **TanStack Query** for data fetching
- **shadcn/ui** components in `/src/components/ui`
- **Octokit** for GitHub API calls (runs in frontend, not backend)
- Path alias: `@/` maps to `./src/`

### Backend (`/src-tauri`)

- **Rust with Tauri 2** framework
- **git2** for local git operations (diff generation)
- **SQLite** via rusqlite for persistence
- **two-face/Syntect** for syntax highlighting
- **tauri-specta** auto-generates TypeScript bindings from Rust commands

### Key Directories

- `/src/routes` - Page components (index, repos.$owner.$repo, pulls.$owner.$repo.$number)
- `/src/hooks` - Custom hooks including `useRpcQuery.ts` for Tauri IPC
- `/src/lib/repos.ts` - Repo path storage using Tauri LazyStore
- `/src/context/GithubContext.tsx` - Auth state and Octokit instance
- `/src-tauri/src/commands` - Tauri IPC command handlers
- `/src-tauri/src/services` - Business logic (auth, diff, git, highlight, review)

### Data Flow

1. GitHub API calls happen in the frontend via Octokit
2. Repo registry (GitHub repo ID â†’ local path) stored in Tauri Store on frontend
3. Local git operations (diffs, commits) go through Tauri commands to the Rust backend (frontend passes `localDir` to commands)
4. Review tracking persists to per-repo SQLite (`.git/pr-manager.db`) via backend commands

### Database Schema

Per-repository SQLite database at `.git/revue.db`. Single table: `reviewed_files` (tracks reviewed files with composite key: change_id, file_path, patch_id)

### IPC Pattern

Rust commands in `/src-tauri/src/commands/` return `Result<T, CommandError>`. TypeScript bindings are auto-generated by tauri-specta. Use hooks in `/src/hooks/useRpcQuery.ts` to call backend.
call tauri commands with custom useFailableQuery and useRpcMutation hooks at src/hooks/useRpcQuery.ts

## Code Style

- No semicolons
- Newtype wrappers for IDs: `PatchId`, `ChangeId` in `/src-tauri/src/models/git.rs`
